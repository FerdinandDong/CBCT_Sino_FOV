model:
  name: pconv_unet
  params:
    in_ch_img: 1           # noisy 图像通道数（不含 mask/angle）
    add_angle_channel: true
    base: 64
    depth: 6
    up_mode: nearest       #  bilinear
    out_act: null          # 可选: sigmoid/tanh/null

data:
  use_dummy: false
  root_noisy: /data/shared_folder/projectionsNoisy
  root_clean: /data/shared_folder/projectionsNoisy
  ids: [] # null #[] #  ids: null 全部文件 

  exclude_ids: [0, 10, 11] # !!!! 注意!!!!!!!!!!根据testxt修改排除test 严格隔离

  step: 1
  downsample: 2
  truncate_left: 350
  truncate_right: 350
  mask_mode: fixed
  normalize: percentile
  add_angle_channel: true
  batch_size: 16
  num_workers: 4
  pin_memory: true

  # 可选项  
  cache_strategy: lru     # none | lru | per_id  （默认 lru）
  max_cached_ids: 2       # lru 模式最多缓存多少个 id（默认 2）

  # DataLoader 行为
  persistent_workers: true
  prefetch_factor: 2      # 每个 worker 预取多少个 batch 2*4 = 8 加速用

  split:
    mode: files               # 或 ratio 想一下无txt
    list_format: id
    train_list: splits/train.txt
    val_list:   splits/val.txt
    test_list:  splits/test.txt

  val_batch_size: 8
  test_batch_size: 8

train:
  device: cuda
  epochs: 150
  lr: 3e-4
  sched:
    type: cosine      # cosine | step
    T_max: 150        # epochs 一致
    eta_min: 1e-6


  # sched:
  #   type: cosine   # cosine | step
  #   eta_min: 1e-6  # 仅 cosine
  #   step_size: 50  # 仅 step
  #   gamma: 0.5     # 仅 step

  ckpt_dir: checkpoints/pconv_unet
  ckpt_prefix: pconv_unet      # 文件名前缀，可选；默认用模型类名
  save_every: 1                # 每多少 epoch 存一次
  max_keep: 5                  # 最多保留 N 个，超出会删最旧的

  resume: "auto"               # "auto"=从目录最新的接着训；可填具体路径；false不续训
  strict_load: true            # 恢复模型 state_dict 的严格模式

  resume_from: checkpoints/pconv_unet/pconv_unet_epoch0.pth
  reset_epoch: true
  reset_optim: true            # 恢复时是否重置 epoch 和优化器+强指定

  use_tqdm: true               # 后台模式use_tqdm:false → 关 tqdm，转而用 log_interval 打印
  log_interval: 100            # 每多少个 batch 打印一次

  #Loss 消融实验思路L2 → L2L1 → +Perceptual → +Edge → +Style → +LPIPS）
  loss:
    type: combined         # combined / l1 / l2
    opts:

      # use_style: true
    #   use_ssim: true
      use_edge: true
      use_lpips: true
      use_l1_hole_valid: true
      use_l2: true
      # use_perceptual: true  # 下载权重时  
          
      w_l2: 1.0      
      # w_perc: 20.0
      w_l1_hole: 0.1
      w_l1_valid: 0.01
      # w_style: 200.0
    #   w_ssim: 0.001
      w_edge: 0.01
      w_lpips: 0.8

      imagenet_norm_for_vgg: true      # 开启 VGG 归一化默认就是 True
      use_vgg_pretrained: true         # 用 ImageNet 预训练权重
  # loss:
  #   type: combined         # combined / l1 / l2
  #   opts:
  #     use_perceptual: true  # 下载权重时
  #     use_style: true
  #     use_ssim: true
  #     use_edge: true
  #     use_lpips: true
  #     w_perc: 20.0
  #     w_style: 200.0
  #     w_ssim: 0.001
  #     w_edge: 0.4
  #     w_lpips: 0.8
  #     w_l1_hole: 0.1
  #     w_l1_valid: 0.01
  #     use_l2: true
  #     w_l2: 1.0


  val_metric: loss   # 或 psnr / ssim / None
  # maximize_metric: false  # 当 val_metric=loss 时自动设为 False